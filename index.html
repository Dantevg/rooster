<HTML>
<HEAD>
	<title>Alternatief rooster</title>
	<link rel="stylesheet" type="text/css" href="/style.css">

	<script src="/cookie.min.js"></script>
	<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
	<script src="format.js"></script>
	<script type="text/javascript">
		function getSchedule(user, offset){
			if( user == "" ){ user = Cookies.get("user") }
			if( user == "" ){ user = "0000" }
			$.getJSON( "https://citadelcollege.zportal.nl/api/v3/appointments?user=" + user + "&startWeekOffset=" + offset + "&endWeekOffset=" + (Number(offset)+1) + "&access_token=fg0ndvvhh04stm80josoimuok4" )
				.done( function(data){
					$("main .rooster").empty()
					format(data["response"]["data"])
					$(".lesson").click(function(e){
						e.stopPropagation()
						var thislesson = this
						
						if( $(".top").length >= 1 ){
							$(".lesson").removeClass("big")
							setTimeout( function(){
								$(".lesson").removeClass("top")
								$(thislesson).addClass("big")
								$(thislesson).addClass("top")
							}, 300 )
							
						}else{
							$(thislesson).addClass("big")
							$(thislesson).addClass("top")
						}
						
					})
				})
				.fail(function(data,status,err){
					console.log( "Fail\n----\nStatus: " + status + "\nError: " + err )
				}) // End getJSON
		}

		$(function(){
			if(typeof Cookies.get("user") == "undefined"){
				user = prompt("Vul je leerlingnummer in.\n\nMet het invullen ga je akkoord met het plaatsen van een cookie.")
				if(user!=null){
					Cookies.set( "user", user, {expires: 2190} )
					getSchedule( user, 0 )
				}
			}else{
				user = Cookies.get("user")
				getSchedule( user, 0 )
			}

			$("#week").change(function(){
				getSchedule( $("#user").val().toLowerCase(), $("#week option:selected").val() )
			})
			$("#user").keyup( function(e){
				getSchedule( $("#user").val().toLowerCase(), $("#week option:selected").val() )
			})
			$("#print").click(function(){
				$(".form").css("display", "none")
				window.print()
				$(".form").css("display", "block")
			})
			$("html").click(function(){
				$(".lesson").removeClass("big")
				setTimeout( function(){ $(".lesson").removeClass("top") }, 300 )
			})
		})
	</script>
</HEAD>
<BODY>
	<div class="form">
		<label for="week">Week: </label>
		<select name="week" id="week">
			<option value="-2">Twee weken terug</option>
			<option value="-1">Vorige week</option>
			<option value="0" selected="selected">Deze week</option>
			<option value="1">Volgende week</option>
			<option value="2">Twee weken vooruit</option>
		</select>
		<label for="user">Leerlingnummer / docentcode: </label>
		<input type="text" name="user" id="user">
		<button id="print">Print</button>
	</div>

	<main>
		<div class="tijd"><span>8:30</span><span>9:30</span><span>10:30</span><span>11:30</span><span>12:30</span><span>13:30</span><span>14:30</span><span>15:30</span><span>16:30</span></div>
		<div class="dag"><span>ma</span><span>di</span><span>wo</span><span>do</span><span>vr</span></div>
		<div class="rooster"></div>
	</main>
</BODY>
</HTML>
